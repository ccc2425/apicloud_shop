<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <title>title</title>
      <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
      <!-- <link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/> -->
      <link rel="stylesheet" type="text/css" href="../../css/aui-slide.css" />
      <link rel="stylesheet" type="text/css" href="../../css/iconfont.css"/>
      <link rel="stylesheet" type="text/css" href="../../css/public.css"/>
      <style>
          *{
            box-sizing: border-box;
          }
          body{
            line-height: 21px;
          }
          #header{
            z-index: 99;
            width: 100%;
            position: fixed;
            /*background-color: transparent;*/
            background: rgba(255, 255, 255, 0);
            /*top: 0;*/
          }
          .icon{
              display: block;
              width: 32px;
              height: 32px;
              border-radius: 50%;
              background-color: rgba(0, 0, 0, 0.3);
              line-height: 32px;
          }
          .header{
            height: 40px;
            line-height: 40px;
          }
      /*banner图*/
          .mui-slider-indicator .mui-indicator{
            width: 3px;
            height: 3px;
            margin: 1px;
          }
          .mui-table-view-cell.mui-collapse .mui-collapse-content{
            display: block;
          }
          .classfial-list{
            font-size: 10px
          }
          .classfial-list li{
            float: left;
            width: 20%;
            text-align: center;
          }
          .mui-slider .mui-slider-group .mui-slider-item .classfial-list li img{
            display: block;
            width: 64%;
            border-radius: 50%;
            margin: 5px auto 0;
          }
          /*商品信息*/
          .item-box{
            width: 100vw;
          }
          .vouchers-list1{
            width: 100%;
            font-size: 14px;
            line-height: 20px;
          }
          .vouchers-list1 img{
            width: 4vw;
            height: 4vw;
            margin-right: 2vw;
            vertical-align: text-bottom;
          }
          .vouchers-list2{
            font-size: 12px;
            color: #d4237a;
            margin: 10px 0
          }
          .original{
            text-decoration: line-through;
          }
          .coupon{
            background-color: red;
            color: #fff;
            line-height: 18px;
            padding: 0 2vw;
          }
          .upgrade{
            width: 94vw;
            margin: auto;
            padding: 3px 2vw;
            background: #f3ca7e;
            border-radius: 5px;
            color: #dd6572;
            font-size: 12px;
          }
          /*领券*/
          .bgle{
            float: left;
            width: 100%;
            background: url(../../image/quan1.png) no-repeat;
            background-size: 100% 100%;
          }
          .coupon-box{
            width: 100vw;
            padding: 10px 2vw;
          }
          .price{
            width: 20vw;
            height: 50px;
            padding-left: 3vw;
          }
          .time{
            width: 48vw;
            padding: 5px 0
          }
          .getcoupon{
            position: absolute;
            right: 2vw;
            height: 50px;
            width: 28vw;
            background: url(../../image/quan2.png) no-repeat;
            background-size: 100% 100%;
          }
          /*推荐*/
          .recommended{
            /*padding: 10px 3vw;*/
          }
          /*商品评价*/
          .evaluation-name img{
            width: 4vw;
            height: 4vw;
            margin-right: 2vw;
            vertical-align: text-bottom;
            border-radius: 50%;
          }
          .evaluation-img img{
            float: left;
            margin-right: 2vw;
            width: 23vw;
            height: 23vw;
          }
          /*商家名字*/
          .store-name img{
            width: 4vw;
            height: 4vw;
            margin-right: 2vw;
            vertical-align: text-bottom;
          }
          .store-go{
            padding: 0 3vw;
            border-radius: 20px;
          }
          .store-evaluation{
            display: flex;
            justify-content: space-between;
          }
          .store-evaluation div{
            margin: 0 3vw;
          }
          /*猜你喜欢*/
          .like-tit img{
            width: 4vw;
            height: 4vw;
            margin-right: 2vw;
            vertical-align: text-bottom;
          }
          .like-box ul li{
            margin: 0 .5vw 5px;
            /*margin-right: 1vw;*/
          }
          .vouchers-list{
            margin-bottom: 10px;
          }
          .vouchers-tit{
            border-bottom: 1px solid #ccc;
          }
          .titimg{
            width: 5vw;
            height: 5vw;
            margin-bottom: 5px;
          }
          .vouchers-list{
            width: 48vw;
            padding: 1vh 1vw;
            background-color: #fff;
          }
          .vouchers-list-left{
            position: relative;
            width: 100%;
            height: 160px;
          }
          .peoplenum{
            position: absolute;
            left: 0;
            bottom: 0;
            width: 100%;
            color: #fff;
            background: linear-gradient(to right,rgba(0,0,0,.3),rgba(0,0,0,.5),rgba(0,0,0,.3));
          }
          .vouchers-list-right{
            width: 100%;
            padding-top: 10px;
          }
          .vouchers-list1{
            width: 100%;
            font-size: 14px;
            line-height: 18px;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
          }
          .vouchers-list1 img{
            width: 4vw;
            height: 4vw;
            margin-right: 2vw;
            vertical-align: top;
          }
          .vouchers-list3{
            font-size: 12px;
          }
          .original{
            color: #ccc;
            text-decoration: line-through;
          }
          .coupon{
            background-color: red;
            color: #fff;
            line-height: 18px;
            padding: 0 1vw;
          }
          .vouchers-list4 span{
            vertical-align: top;
          }
          .vouchers-list4 span:first-child{
            color: #fff;
            padding: 0 1vw;
            line-height: 18px;
            font-size: 10px;
          }
          .vouchers-list4 span:first-child{
            background-color: #e8989a;
            border-radius: 3px;
          }
          .vouchers-list4 span:last-child{
            background-color: #e8989a;
          }
          .tishi{
            position: fixed;
            top: 12vh;
            left: 5vw;
            padding: 0 5px;
            border-radius: 30px;
            line-height: 30px;
            background: rgba(0, 0, 0, 0.5);
            font-size: 12px;
            color: #fff;
            opacity: 0;
          }
          .tishi_header{
            width: 20px;
            height: 20px;
            border-radius: 50%;
            overflow: hidden;
            margin-top: 5px;
            margin-right: 5px;
          }
      </style>
  </head>
  <body>
    <div id="header" class="">
      <div class="clearfix text-center header fs18">
          <span class="fl ml3v icon"><i onclick="closewin()" class="iconfont iwh">&#xe601;</i></span>
          商品详情
          <span class="fr mr3v icon"><i onclick="backhome()" class="iconfont iwh">&#xe6d9;</i></span>
      </div>
    </div>
    <!-- 轮播图 -->
    <div id="aui-slide" class="">
      <div id="banner" class="aui-slide-wrap boradius" >
      </div>
      <div class="aui-slide-page-wrap"><!--分页容器--></div>
    </div>
    <!-- 商品信息 -->
    <div class="item-box pad10a2v bgcf">
      <div class="vouchers-list1 mb5 vouchers_list">
      </div>
      <div class="vouchers-list2 texthidden clearfix vouchers_list">
        <!-- <span class="coupon fl mr3v boradius3">券后</span>￥
        <span class="fs18">69</span>
        <span class="original cogry">原价169</span>
        <span class="fr cogry">24871人已买</span> -->
      </div>
      <div class="upgrade clearfix">
        <span><i></i>现在升级顶级运营商，最高可得佣金￥10.35</span>
        <span class="fr">立即升级></span>
      </div>
    </div>
    <!-- 领券 -->
    <div class="coupon-box bgce clearfix">
      <div class="bgle clearfix vouchers_list">
      </div>
      <div class="getcoupon lh50 text-center">
        <!-- 立即领券 -->
      </div>
    </div>
    <!-- 推荐理由 -->
    <div class="recommended fs12 bgcf mb10 pad10a3v">
        <p id="recommend" class="fs12">
        </p>
    </div>
    <!-- 商品评价 -->
    <div class="evaluation pad10a3v fs12 bgcf mb10 vouchers_list">
    </div>
    <div class="store pad10a3v bgcf mb10 vouchers_list">
    </div>
    <!-- 商品详情 -->
    <div class="details bgcf mb10">
      <div class="text-center fs13 lh29">
        商品详情
      </div>
      <div>
        <img src="../../image/cbd.jpg" alt="">
        <img src="../../image/gouwu.png" alt="">
      </div>
    </div>
    <!-- 猜你喜欢 -->
    <div class="like bgcf mb10">
      <div class="like-tit mb5 clearfix text-center lh29">
        <img src="../../image/pdd.png">
        <span>猜你喜欢</span>
      </div>
      <div class="like-box pad1v bgce">
        <ul id="item" class="clearfix">
          <!-- <li onclick="openitem()" class="vouchers-list fl">
            <div class="vouchers-list-left">
              <img src="../image/muwu.jpg" alt="">
              <div class="peoplenum text-center">自购赚￥0.47</div>
            </div>
          </li> -->
        </ul>
      </div>
    </div>
    <!-- 以购买提示 -->
    <diV class="clearfix tishi">
      <div class="fl tishi_header">
        <img src="../../image/tm.png" alt="">
      </div>
      <div class="fl">
        某某某购买了该产品
      </div>
    </diV>
  </body>
  <script type="text/javascript" src="../../script/api.js"></script>
  <script type="text/javascript" src="../../script/aui-slide.js"></script>
  <script type="text/javascript" src="../../script/aui-scroll.js" ></script>
  <script type="text/javascript" src="../../script/md5.js"></script>
  <script type="text/javascript" src="../../script/ajax.js"></script>
  <script type="text/javascript">
      var header;
      var frameWidth;
      var frameHeight
      apiready = function(){
        header = $api.byId('header');
        $api.fixStatusBar(header);
        var headerH = $api.offset(header);
        var item_id = api.pageParam.item_id;
        frameWidth = api.frameWidth || '';
        frameHeight = api.frameHeight || '';
        var banner = $api.byId('banner');
        var vouchers_list = document.getElementsByClassName('vouchers_list');
        var recommend = $api.byId('recommend');
        var item = $api.byId('item');
        var tishi = document.getElementsByClassName('tishi');
        axios({
          url: '/api/rmitems/itemdetail',
          data:{
            token:$api.getStorage('token'),
            screenw:frameWidth,
            screenh:frameHeight,
            item_id:item_id
          }
        },function(ret){
          // console.log(JSON.stringify(ret));
          var html = "";
          var imgLength = ret.data.item_image.length;
          for (var i = 0; i < imgLength; i++) {
            console.log(ret.data.item_image[i]);
            html += `<div class="aui-slide-node bg-dark">
                <img src="${ret.data.item_image[i]}" />
            </div>`
          };
          banner.innerHTML = html;
          //轮播
          var slide = new auiSlide({
             container:document.getElementById("aui-slide"),
             // "width":300,
             "height":260,
             "speed":300,
             "pageShow":true,
             "autoPlay": 1000, //自动播放
             "pageStyle":'dot',
             "loop":true,
             'dotPosition':'center',
         })
          vouchers_list[0].innerHTML = `<img src="../../image/${ret.data.item_type}.jpg">${ret.data.title}`;
          vouchers_list[1].innerHTML = `<span class="coupon fl mr3v boradius3">券后</span>￥
                                        <span class="fs18">${ret.data.end_price}</span>
                                        <span class="original cogry">原价${ret.data.old_price}</span>
                                        <span class="fr cogry">${ret.data.sales}人已买</span>`;
          vouchers_list[2].innerHTML = `<div class="price fs12 cored lh50 fl">
                                          ￥<span class="fs20">${ret.data.coupon_price}</span>
                                        </div>
                                        <div class="time fs10 lh20 fl">
                                          <span class="cobck">优惠券有效期：</span></br>
                                          <span class="cogry">${ret.data.coupon_end}</span>
                                        </div>`;
          vouchers_list[3].innerHTML = `<div class="clearfix">
                                          <span class="fl">商品评价（<span>${ret.data.evaluate.all_num}</span>）</span>
                                          <span class="fr cored">查看全部<i>></i></span>
                                        </div>
                                        <div class="evaluation-box">
                                          <div class="evaluation-name mb5">
                                            <img src="${ret.data.evaluate.last.last_header}">
                                            ${ret.data.evaluate.last.last_nick}
                                          </div>
                                          <div class="evaluation-text">
                                            ${ret.data.evaluate.last.last_content}
                                          </div>
                                          <div class="evaluation-img clearfix">
                                          </div>
                                        </div>`;
          var evaluationImg = document.getElementsByClassName('evaluation-img');
          for (var j = 0; j < ret.data.evaluate.last.last_img.length; j++) {
            evaluationImg[0].innerHTML += `<img src="${ret.data.evaluate.last.last_img[j]}">`
          }
          recommend.innerHTML = `<span class="bold">推荐理由：</span>${ret.data.recommend_msg}<span class="cored">复制</span>`;
          vouchers_list[4].innerHTML = `<div class="store-name mb5 clearfix">
                                          <img src="${ret.data.seller.seller_ico}">
                                          <span>${ret.data.seller.seller_name}</span>
                                          <span class="bgco fr fs12 store-go" onclick="openstore(${ret.data.seller.seller_id})">进店逛逛</span>
                                        </div>
                                        <div class="store-evaluation fs11">
                                            <div>宝贝描述<span class="cored bold">${ret.data.seller.desc}</span></div>
                                            <div>卖家服务<span class="cored bold">${ret.data.seller.serv}</span></div>
                                            <div>物流服务<span class="cored bold">${ret.data.seller.post}</span></div>
                                        </div>`;
          var item_length = ret.data.recommend.length;
          var item_html = "";
          for (var k = 0; k < item_length; k++) {
            item_html +=`<li onclick="openitem(${ret.data.recommend[k].item_id})" class="vouchers-list fl">
              <div class="vouchers-list-left">
                <img src="${ret.data.recommend[k].master_image}" alt="">
              </div>
              <div class="vouchers-list-right">
                <div class="vouchers-list1 texthidden mb5">
                  <img src="../../image/${ret.data.recommend[k].item_id}.png">
                  ${ret.data.recommend[k].title}
                </div>
                <div class="fs12 texthidden mb5 cogry">
                  <i class="iconfont cored mr1v fs12">&#xe663;</i>${ret.data.recommend[k].item_id}
                </div>
                <div class="vouchers-list3 clearfix cogry mb5">
                  原价：￥<span class="original">￥${ret.data.recommend[k].old_price}</span>
                  <span class="fr">${ret.data.recommend[k].sales}人已买</span>
                </div>
                <div class="vouchers-list4 cooo fs10">
                  <span class="">券后价</span>
                  ￥<span class="discount mr1v cooo fs16">${ret.data.recommend[k].end_price}</span>
                  <span class="coupon fr fs12">${ret.data.recommend[k].coupon_price}元券</span>
                </div>
              </div>
            </li>`
          };
          item.innerHTML = item_html;
          var rollMsg = ret.data.roll_msg;
          var roll_html = "";
          // for (var l = 0; l < rollMsg.length; l++) {
          //   roll_html = `<div class="fl tishi_header">
          //     <img src="${rollMsg[l].header}" alt="">
          //   </div>
          //   <div class="fl">
          //     ${rollMsg[l].nickname}${rollMsg[l].msg}
          //   </div>`
          // }
          var l;
          l = 0;
          // var t;
          var t2 = window.setInterval(function() {
            // t=100;
            if (l < rollMsg.length) {
              tishi[0].style.opacity = "1";
              roll_html = `<div class="fl tishi_header">
                <img src="${rollMsg[l].header}" alt="">
              </div>
              <div class="fl">
                ${rollMsg[l].nickname}${rollMsg[l].msg}
              </div>`
              tishi[0].innerHTML = roll_html;
              var t3 = setInterval(function() {
                  tishi[0].style.opacity = "0";
                  clearInterval(t3)
              },2000)
              // tishi[0].style.opacity = "0";
              l++
            } else {
              window.clearInterval(t2)  // 去除定时器
            }
          },3000)
          // var t3 = setInterval(function() {
          //   if (l < rollMsg.length) {
          //     t--;
          //     if (t<0) {
          //       t=0;
          //       clearInterval(t3)
          //     }
          //     tishi[0].style.opacity = t/100;
          //   } else {
          //     window.clearInterval(t2)  // 去除定时器
          //   }
          // },10)
          api.sendEvent({
              name: 'shareprice',
              extra: {
                  share_price: ret.data.share_price,
                  self_price: ret.data.self_price
              }
          });

        })
      };
   //监听滑动
   var scroll = new auiScroll({
       listen:true,
       distance:200 //判断到达底部的距离，isToBottom为true
   },function(ret){
     var scrollTop = ret.scrollTop;
    //  console.log(scrollTop);
     if (scrollTop>300) {
       scrollTop = 100;
       return scrollTop;
     }
     header.style.background = 'rgba(255,255,255,' + scrollTop / 100 + ')';

   });
      // 打开商品
      function openitem() {
        api.openWin({
            name: 'item',
            url: './item.html',
            pageParam: {
                name: 'test'
            }
        });
      }
      //关闭该页面
      function closewin() {
        api.closeWin({
            name: 'item'
        });
      }
  </script>
  </html>
