<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <title>title</title>
      <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
      <link rel="stylesheet" type="text/css" href="../../css/iconfont.css"/>
      <link rel="stylesheet" type="text/css" href="../../css/public.css" />
      <style>
      * {
          -webkit-box-sizing: border-box;
          box-sizing: border-box;
          -webkit-user-select: none;
          outline: 0;
          -webkit-tap-highlight-color: transparent;
          -webkit-tap-highlight-color: transparent;
      }
      html,body{
        height: 100vh;
      }
      .mui-indexed-list {
          position: relative;
          overflow: hidden;
          background-color: #fafafa;
          cursor: default;
      }

      .mui-indexed-list-bar div a {
          display: block;
          text-align: center;
          padding: 0px;
          margin: auto;
          font-size: 13px;
          line-height: 26px;
          color: #333;
      }

      .mui-indexed-list-group {
          padding-top: 3px;
          padding-bottom: 3px;
          line-height: 30px;
          font-weight: bold;
      }

      .mui-indexed-list-group>span {
          font-weight: normal;
          margin-right: 8vw;
          color: #999;
      }

      .mui-table-view-divider {
          position: relative;
          margin-top: -1px;
          margin-left: 0;
          padding-bottom: 6px;
          padding-left: 20px;
          font-size: 14px;
      }

      .mui-table-view-cell {
          position: relative;
          overflow: hidden;
          padding: 11px 15px;
          -webkit-touch-callout: none;
      }

      .mui-table-view {
          background-color: #fff;
      }

      .mui-table-view>div>li>ul>li {
          display: inline-block;
          width: 25vw;
          text-align: center;
          font-size: 12px;
      }

      .mui-table-view>div>li>ul>li>div {
          width: 16vw;
          height: 16vw;
          margin: 5px auto;
          border-radius: 50%;
          overflow: hidden;
      }

      .mui-table-view-cell:after {
          height: 0;
      }

      #nav {
          position: absolute;
          left: 0px;
      }
      .mui-indexed-list-bar {
          width: 20vw;
          background-color: #fff;
          /*position: absolute;*/
          /*height: 100%;*/
          z-index: 10;
          left: 0px;
          -webkit-transition: .2s;
          border-right: 1px solid #eee;
          overflow-x: hidden;
          overflow-y: scroll;
          height: calc(100vh - 95px);
      }

      .mui-indexed-list-bar::-webkit-scrollbar {
          display: none;
      }


      .mui-table-view {
          width: 100vw;
          height: 100vh;
          padding-left: 20vw;
          padding-top: 5px;
          overflow-x: hidden;
          overflow-y: scroll;
          height: calc(100vh - 95px);
      }
      /**/

      .search-box {
          width: 100%;
          padding: 5px 2vw 10px;
          font-size: 15px;
          line-height: 30px;
          color: #999;
      }

      .active {
          width: 88%;
          border-radius: 30px;
          height: 24px;
          line-height: 24px;
          margin: auto;
          background-color: #F03F3F;
          color: #fff!important;
          box-shadow: 0px 2px 8px #F03F3F;
      }

      .mui-indexed-list-bar div {
          height: 43px;
          padding: 13px 0;
      }

      .mui-indexed-list-bar a:active {}

      .sticky {
          position: fixed;
          box-sizing: border-box;
          width: 100%;
          top: 0;
          z-index: 100;
          margin: auto;
      }
      </style>
  </head>
  <body>
    <div id="header" class="bgcf">
        <div class="search-box">
            <div onclick="openSearch()" class="search text-center boradius30 bgce">
                <i class="iconfont fs15 mr2v">&#xe638;</i>请输入搜索内容
            </div>
        </div>
    </div>
    <div id="nav">
      <div id="nav_list" class="mui-indexed-list-bar">
          <!-- <div>
              <a href="#classify1" class="active">女装</a>
          </div> -->
      </div>
    </div>
    <ul id="items" class="mui-table-view clearfix">
      <div id="classify0" class="classify">
        <!-- <li class="mui-table-view-divider mui-indexed-list-group">${ret.data[i].class_name}<span onclick="openmore((${ret.data[i].cid})" class="fr">查看更多</span></li>
        <li>
          <ul class="clearfix classify-list">
          </ul>
        </li> -->
      </div>
      <div id="classify1" class="classify">
      </div>
      <div id="classify2" class="classify">
      </div>
      <div id="classify3" class="classify">
      </div>
      <div id="classify4" class="classify">
      </div>
      <div id="classify5" class="classify">
      </div>
      <div id="classify6" class="classify">
      </div>
      <div id="classify7" class="classify">
      </div>
      <div id="classify8" class="classify">
      </div>
      <div id="classify9" class="classify">
      </div>
      <div id="classify10" class="classify">
      </div>
      <div id="classify11" class="classify">
      </div>
      <div id="classify12" class="classify">
      </div>
      <div id="classify13" class="classify">
      </div>
    </ul>
  </body>
  <script type="text/javascript" src="../../script/api.js"></script>
  <script type="text/javascript" src="../../script/jquery-1.7.2.min.js"></script>
  <script type="text/javascript" src="../../script/md5.js"></script>
  <script type="text/javascript" src="../../script/ajax.js"></script>
  <script type="text/javascript">
      apiready = function() {
          var headers = $api.byId('header');
          var nav_list = $api.byId('nav_list');
          var items = $api.byId('items');
          $api.fixStatusBar(headers);
          // $api.getStorage('token');
          // console.log(token);
          console.log($api.getStorage('token'));
          axios({
            url: '/api/rmitems/dtkclass',
            data:{
            }
          },function(ret){
            // console.log(JSON.stringify(ret));
            var classify = document.getElementsByClassName('classify')
            var length = ret.data.length;
            console.log(length);
            var list_html = "";
            var item_html = "";
            for (var i = 0; i < length; i++) {
              // 导航栏
              if (i===0) {
                list_html += '<div><a href="#classify'+i+'" class="active">'+ret.data[i].class_name+'</a></div>'
              }else {
                list_html += '<div><a href="#classify'+i+'">'+ret.data[i].class_name+'</a></div>'
              }
              //分类盒
              var leng = ret.data[i].children.length;
              var classifyList_html = "";
              for (var j = 0; j < leng; j++) {
                classifyList_html += `<li onclick="itemlist(${ret.data[i].cid},${ret.data[i].children[j].cid},'${ret.data[i].children[j].class_name}')" data-value="" data-tags="" class="mui-table-view-cell mui-indexed-list-item">
                <div>
                <img src="${ret.data[i].children[j].class_image}" alt="">
                </div>
                <span>${ret.data[i].children[j].class_name}</span>
                </li>`
              }
              //分类
              item_html += `<div id="classify${i}" class="classify">
                <li class="mui-table-view-divider mui-indexed-list-group">${ret.data[i].class_name}<span onclick="openmore(${ret.data[i].cid},'${ret.data[i].class_name}')" class="fr fs12">查看更多</span></li>
                <li>
                  <ul class="clearfix classify-list">
                  ${classifyList_html}
                  </ul>
                </li>
              </div>`;

            }
            nav_list.innerHTML = list_html;
            items.innerHTML = item_html;
            scrolls()
          })
      };
      //打开分类页面
      function itemlist(id1,id2,tit) {
        console.log(tit);
          api.openWin({
              name: 'itemlist',
              url: '../home/itemlist.html',
              pageParam: {
                  id1: id1,
                  id2: id2,
                  tit: tit
              }
          });
      }
      function openmore(id1,tit) {
          api.openWin({
              name: 'itemlist',
              url: '../home/itemlist.html',
              pageParam: {
                  id1: id1,
                  tit: tit
              }
          });
      }
      //导航栏活动
      var list = document.querySelectorAll('.mui-indexed-list-bar a div');
      var listA = document.querySelectorAll('.mui-indexed-list-bar a');
      var len = list.length;
      /* show active navigation element */
      // $(document).ready(function() {
      var old_h = 0;
      var old_hs;
      function scrolls() {
        // $('#items').on("scroll", onScroll);
          // $(document).on("scroll", onScroll);
          //smooth scrolling
          $('a[href^="#"]').on('click', function(e) {
              // e.preventDefault();
              // $(document).off("scroll");
              $('a').each(function() {
                  $(this).removeClass('active');
              })
              $(this).addClass('active');
              var now_h = $($(this).attr("href")).offset().top - 85;
              old_h = $('#items').scrollTop();
              old_hs = now_h + old_h;
              console.log(old_hs);
              console.log(JSON.stringify($($(this).attr("href")).offset()));
              console.log(JSON.stringify($('#items').scrollTop()));
              // $("#items").animate({scrollTop: $($(this).attr("href")).offset().top + "px"}, 500);
              // return false;//不要这句会有点卡顿
              // var index_ = $(this.parentNode).index();
              // console.log(index_);
              // var _index = index_ * 366;
              // // var target = this.hash,
              // //     nav = target;
              // // $target = $(target);
              $('#items').animate({
              // $('html, body').stop().animate({
                  // 'scrollTop': $target.offset().top
                  'scrollTop': old_hs
              }, 500, 'swing', function() {
                  // window.location.hash = target;
                  // $(document).on("scroll", onScroll);
                  // return;
                  // $('#items').on("scroll", onScroll);
              });
          });
      }
      // });
      //get scroll position and handle class active
      $('#item').scroll(function() {
        console.log(11);
      });
      //打开搜索页
      function openSearch() {
        api.openWin({
            name: 'search',
            url: '../public/search.html',
            pageParam: {
                name: 'test'
            }
        });
      }
  </script>
  </html>
